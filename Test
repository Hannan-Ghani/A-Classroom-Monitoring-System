const fs = require('fs');
const diff = require('deep-diff').diff;

// Function to read and parse JSON from a file
function readJSONFile(filePath) {
    try {
        return JSON.parse(fs.readFileSync(filePath, 'utf8'));
    } catch (error) {
        console.error(`Error reading file from disk: ${error}`);
        process.exit(1);
    }
}

// Function to mark differences in the JSON object
function markDifferences(original, target) {
    const differences = diff(original, target) || [];
    differences.forEach(difference => {
        // Logic to mark differences, similar to previous examples
    });
}

// Enhanced jsonToHtml function to handle unmarked JSON
function jsonToHtml(json, indent = 0) {
    // Logic to convert JSON to HTML, similar to previous examples, without marking differences
}

// Function to create side-by-side HTML content
function createSideBySideHtml(originalJson, modifiedJson) {
    const originalHtml = jsonToHtml(originalJson);
    const modifiedHtml = jsonToHtml(modifiedJson);

    return `<html><head><style>
        body { font-family: monospace; white-space: pre; display: flex; justify-content: space-around; padding: 20px; background-color: #f5f5f5; }
        .container { width: 50%; }
        .added { background-color: #ddffdd; }
        .deleted { background-color: #ffdddd; text-decoration: line-through; }
        .edited { background-color: #ffffcc; }
        pre { background-color: #fff; border-radius: 5px; padding: 10px; }
    </style></head><body>
    <div class="container"><h2>Original JSON</h2><pre>${originalHtml}</pre></div>
    <div class="container"><h2>Modified JSON</h2><pre>${modifiedHtml}</pre></div>
    </body></html>`;
}

// Main function that reads JSON files, marks differences, and generates an HTML output.
function compareAndHighlight(jsonFilePath1, jsonFilePath2, outputHtmlPath) {
    const originalJson = readJSONFile(jsonFilePath1);
    const modifiedJson = readJSONFile(jsonFilePath2);

    markDifferences(originalJson, modifiedJson); // Apply this only to the modified JSON to mark differences
    const sideBySideHtml = createSideBySideHtml(originalJson, modifiedJson);

    fs.writeFileSync(outputHtmlPath, sideBySideHtml, 'utf8');
    console.log(`The comparison result has been saved to ${outputHtmlPath}`);
}

// Verify that the correct number of arguments were provided
if (process.argv.length !== 5) {
    console.log('Usage: node compareJsons.js <path to original JSON> <path to modified JSON> <output HTML path>');
    process.exit(1);
}

// Extract file paths from command line arguments
const [,, originalJsonPath, modifiedJsonPath, outputHtmlPath] = process.argv;
compareAndHighlight(originalJsonPath, modifiedJsonPath, outputHtmlPath);
