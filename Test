const fs = require('fs');
const diff = require('json-diff').diff; // Import the diff function

// Function to read a JSON file
const readJSONFile = (filePath) => JSON.parse(fs.readFileSync(filePath, 'utf8'));

// Function to generate and save HTML output
const generateHTML = (differences, outputPath) => {
  let htmlContent = `<html><head><style>
body { font-family: Arial, sans-serif; }
.diff { color: #FFA500; } /* Style for differences */
.added { color: green; } /* Style for additions */
.deleted { color: red; } /* Style for deletions */
</style></head><body><pre>${differences}</pre></body></html>`;

  fs.writeFileSync(outputPath, htmlContent, 'utf8');
  console.log(`Comparison HTML saved to ${outputPath}`);
};

// Main comparison and HTML generation logic
const compareAndGenerateHTML = (filePath1, filePath2, outputPath) => {
  try {
    const json1 = readJSONFile(filePath1);
    const json2 = readJSONFile(filePath2);

    // Use json-diff to find differences
    const differences = diff(json1, json2) || 'No differences found.';
    const formattedDifferences = JSON.stringify(differences, null, 2);

    generateHTML(formattedDifferences, outputPath);
  } catch (error) {
    console.error('Error:', error);
  }
};

// CLI handling logic
if (process.argv.length !== 5) {
  console.log('Usage: node compare.js <jsonFile1> <jsonFile2> <outputHtmlFile>');
} else {
  compareAndGenerateHTML(process.argv[2], process.argv[3], process.argv[4]);
}
