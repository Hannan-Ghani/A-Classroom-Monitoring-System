# Extract the target_cus_path
target_cus_path = [
    line for line in config_data.split("\n") if line.startswith("target cus_path")
][0].split("=")[1].strip()

# Extract add_target_fields
add_target_fields = columns_config["add_target_fields"]

# Read the target_cus data and process it
target_cus = (
    spark.read.parquet(target_cus_path)
    .select(
        'customerUniqueId',
        explode(col('associatedCustomer')).alias('associatedCustomer')
    )
    .select('customerUniqueId', 'associatedCustomer.*')
)

# Register as a temp view for SQL queries
target_cus.createOrReplaceTempView('target_cus')

# Query using the extracted add_target_fields
add_target = spark.sql(f"""
    SELECT {add_target_fields}
    FROM target_cus
""").dropDuplicates()