// =======================
// PART 6: transactionCountryIso3 Validation (with separate Parquet file)
// =======================
val mappingUDF = udf((input: String) => Map(
  "AD" -> "AND", "AE" -> "ARE", "AF" -> "AFG", "AG" -> "ATG", "AI" -> "AIA"
  // Add more mappings here if needed
).getOrElse(input, input))

val sourceTransactionCountry = transactionSource.withColumn("transactionCountryIso3Mapped", mappingUDF($"TRANSACTION_COUNTRY"))
val targetTransactionCountry = caseClass.select($"transactionCountryIso3")

val transactionCountryIso3Validation = sourceTransactionCountry
  .select($"transactionCountryIso3Mapped")
  .exceptAll(targetTransactionCountry)

val transactionCountryIso3OutputPath = s"${outputBasePath}/transactionCountryIso3_validation/"
transactionCountryIso3Validation.write.mode("overwrite").parquet(transactionCountryIso3OutputPath)